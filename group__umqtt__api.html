<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>uMQTT: uMQTT API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">uMQTT
   </div>
   <div id="projectbrief">MQTT client library for microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__umqtt__api.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">uMQTT API</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2>Functions you call to operate MQTT client </h2>
<table class="doxtable">
<tr>
<th>Function Name </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a> </td><td>Create and initialize umqtt instance </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga11ca938958786580b20364192e20156c" title="Clean up and free umqtt client instance. ">umqtt_Delete()</a> </td><td>de-initialize umqtt instace (frees resources) </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> </td><td>main run loop </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#gae9a94c97eefa8711d10ea5ff41b5849c" title="Initiate MQTT protocol Connect. ">umqtt_Connect()</a> </td><td>establish protocol connection to MQTT broker </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga3a3c80101e4e166fe2af31a4a74ad67a" title="Disconnect MQTT protocol. ">umqtt_Disconnect()</a> </td><td>protocol disconnect from MQTT broker </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga42af6bf8d61c0c3e3c56397fde99c73c" title="Send MQTT protocol Publish packet. ">umqtt_Publish()</a> </td><td>publish a topic </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga2a3023f26a715c8d0435f31616630b77" title="Subscribe to topics. ">umqtt_Subscribe()</a> </td><td>subscribe to topic(s) </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga918c13b8fe206d6d70cd0dd14764b891" title="Unsubscribe from topics. ">umqtt_Unsubscribe()</a> </td><td>unsubscribe from topic(s) </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga58f6b719fbe7a24e6b4a169b315d0eb1" title="Get string representing an error code. ">umqtt_GetErrorString()</a> </td><td>get string representation of error code </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga3cb230dbd2737e18b7b1ec454497df3c" title="Get the status of the connection. ">umqtt_GetConnectedStatus()</a> </td><td>determine if connected </td></tr>
</table>
<p>The following are available but you don't need to call these directly, they are called from <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> when needed.</p>
<table class="doxtable">
<tr>
<th>Function Name </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga1bc35b68c4f3bcc8e693b2ef3eb4df40" title="Send a Ping (keep-alive) to the MQTT broker. ">umqtt_PingReq()</a> </td><td>send ping request to MQTT broker </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga9e25d2f2e7334489d543042d78a8720d" title="Decode incoming MQTT packet. ">umqtt_DecodePacket()</a> </td><td>decode a MQTT packet and perform actions </td></tr>
</table>
<h2>Functions you must implement </h2>
<p>These are populated into a <a class="el" href="structumqtt___transport_config__t.html">umqtt_TransportConfig_t</a> structure and passed to <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a>:</p>
<table class="doxtable">
<tr>
<th>Function Name </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga3fc8435f85bb4ad53b2fc0210de9b229" title="Memory allocation function provided by application. ">malloc_t()</a> </td><td>memory allocation for packets </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#gafa4c1067120f9108fc63bc8c42a68582" title="Memory free function provided by application. ">free_t()</a> </td><td>free allocated memory </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#gaec5f88823421a42148a27c1d63816679" title="Read a packet from the network. ">netReadPacket_t()</a> </td><td>read a packet from the network </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga5233352739cce7c13897c73aae5b6c5f" title="Write a packet to the network. ">netWritePacket_t()</a> </td><td>write a packet to the network </td></tr>
</table>
<h2>Optional functions to implement </h2>
<p>These callback functions are used to notify the application when certain events occur. These are populated into a <a class="el" href="structumqtt___callbacks__t.html">umqtt_Callbacks_t</a> structure and passed to <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a>. Unimplemented callback functions can be set to NULL.</p>
<table class="doxtable">
<tr>
<th>Function Name </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga9bc335674490364576a61a3dffb0e9e9" title="Callback function for CONNACK connection acknowledgment. ">ConnackCb_t()</a> </td><td>CONNACK received from broker to acknowledge a CONNECT </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga6304d181e04089265cd9c9f3aca76d4d" title="Callback function for Publish packets. ">PublishCb_t()</a> </td><td>PUBLISH received from broker </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#gad9ebbfb8d7b775d27a8764464aa1bf76" title="Callback function for Puback packets. ">PubackCb_t()</a> </td><td>PUBACK received from broker in response to PUBLISH with QoS != 0 </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#gae94b9fdd705cad6b2cb2b679985e501a" title="Callback function for Suback packets. ">SubackCb_t()</a> </td><td>SUBACK received in response to SUBSCRIBE </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga7f3ee53207f6b2574af5b99cb00386af" title="Callback function for Unsuback packets. ">UnsubackCb_t()</a> </td><td>UNSUBACK received in response to UNSUBSCRIBE </td></tr>
<tr>
<td><a class="el" href="group__umqtt__api.html#ga681d6ac338d10f5f6152cbcabb0fcc03" title="Callback function for PINGRESP packets. ">PingrespCb_t()</a> </td><td>PINGRESP received in response to PINGREQ </td></tr>
</table>
<h2>Run loop and timing </h2>
<p>You must call <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> repeatedly from your main run loop. It is not required that timing be exact between calls. You must maintain a source of millisecond tick values (like a tick timer) and pass the millisecond ticks to <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> each time it is called. This is how <code>umqtt</code> keeps track of timing for timeouts and retries.</p>
<h2>Not thread safe </h2>
<p>These functions are not thread safe. You musn't call them from different threads unless you provide your own resource lock wrapper(s). </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ga48b3931c173f616ae6b9e5aa8fe24a20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga48b3931c173f616ae6b9e5aa8fe24a20">&#9670;&nbsp;</a></span>umqtt_Handle_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void* <a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>umqtt instance handle, to be passed to all functions. </p>
<p>Obtained from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a>. </p>

</div>
</div>
<a id="ga9bc335674490364576a61a3dffb0e9e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9bc335674490364576a61a3dffb0e9e9">&#9670;&nbsp;</a></span>ConnackCb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* ConnackCb_t) (<a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h, void *pUser, bool sessionPresent, uint8_t retCode)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for CONNACK connection acknowledgment. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle </td></tr>
    <tr><td class="paramname">pUser</td><td>client's optional user data pointer </td></tr>
    <tr><td class="paramname">sessionPresent</td><td>MQTT session present flag </td></tr>
    <tr><td class="paramname">retCode</td><td>return code for the MQTT connection attempt</td></tr>
  </table>
  </dd>
</dl>
<p>This function is called when a CONNACK is received in response to <a class="el" href="group__umqtt__api.html#gae9a94c97eefa8711d10ea5ff41b5849c" title="Initiate MQTT protocol Connect. ">umqtt_Connect()</a>. The application can use this callback to know when a connection is complete and ready to be used. </p>

</div>
</div>
<a id="ga6304d181e04089265cd9c9f3aca76d4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6304d181e04089265cd9c9f3aca76d4d">&#9670;&nbsp;</a></span>PublishCb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* PublishCb_t) (<a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h, void *pUser, bool dup, bool retain, uint8_t qos, const char *pTopic, uint16_t topicLen, const uint8_t *pMsg, uint16_t msgLen)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for Publish packets. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle </td></tr>
    <tr><td class="paramname">pUser</td><td>client's optional user data pointer </td></tr>
    <tr><td class="paramname">dup</td><td>MQTT dup header flag was set in the packet </td></tr>
    <tr><td class="paramname">retain</td><td>MQTT retain flag was set in the packet </td></tr>
    <tr><td class="paramname">qos</td><td>QoS level for the packet </td></tr>
    <tr><td class="paramname">pTopic</td><td>pointer to topic string </td></tr>
    <tr><td class="paramname">topicLen</td><td>number of bytes in the topic string </td></tr>
    <tr><td class="paramname">pMsg</td><td>pointer to topic message </td></tr>
    <tr><td class="paramname">msgLen</td><td>number of bytes in the topic message</td></tr>
  </table>
  </dd>
</dl>
<p>This function is called when the umqtt client receives a publish packet from the MQTT broker. While this callback function is optional, it is the only way for the umqtt client application to be notified of publish messages. If any of the packet contents such as the topic or message needs to be retained, then this function must make a copy. Once this function returns the pointers will be no longer valid. </p>

</div>
</div>
<a id="gad9ebbfb8d7b775d27a8764464aa1bf76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad9ebbfb8d7b775d27a8764464aa1bf76">&#9670;&nbsp;</a></span>PubackCb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* PubackCb_t) (<a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h, void *pUser, uint16_t pktId)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for Puback packets. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle </td></tr>
    <tr><td class="paramname">pUser</td><td>client's optional user data pointer </td></tr>
    <tr><td class="paramname">pktId</td><td>packet ID of the received packet</td></tr>
  </table>
  </dd>
</dl>
<p>This function is called when the umqtt client receives a Puback packet in response to <a class="el" href="group__umqtt__api.html#ga42af6bf8d61c0c3e3c56397fde99c73c" title="Send MQTT protocol Publish packet. ">umqtt_Publish()</a>. It is not necessary for the application to use this callback unless it needs to track completion of publish messages. The <em>pktId</em> parameter should match the message ID that was returned when using <a class="el" href="group__umqtt__api.html#ga42af6bf8d61c0c3e3c56397fde99c73c" title="Send MQTT protocol Publish packet. ">umqtt_Publish()</a>. This method could be used to throttle publish actions (ensure that only one publish is sent at a time). The <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> function takes care of tracking acknowledgments and handling retries, so this function is just informative. </p>

</div>
</div>
<a id="gae94b9fdd705cad6b2cb2b679985e501a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae94b9fdd705cad6b2cb2b679985e501a">&#9670;&nbsp;</a></span>SubackCb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* SubackCb_t) (<a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h, void *pUser, const uint8_t *retCodes, uint16_t retCount, uint16_t pktId)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for Suback packets. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle </td></tr>
    <tr><td class="paramname">pUser</td><td>client's optional user data pointer </td></tr>
    <tr><td class="paramname">retCodes</td><td>array of return codes, one for each subscribe topic </td></tr>
    <tr><td class="paramname">retCount</td><td>number of return codes in the retCodes array </td></tr>
    <tr><td class="paramname">pktId</td><td>packet ID of the received packet</td></tr>
  </table>
  </dd>
</dl>
<p>This function is called when the umqtt client receives a Suback packet in response to <a class="el" href="group__umqtt__api.html#ga2a3023f26a715c8d0435f31616630b77" title="Subscribe to topics. ">umqtt_Subscribe()</a>. It is not necessary for the application to use this callback unless it needs to track completion of subscribe messages or needs confirmation of subscribe topic return codes. The <em>pktId</em> parameter should match the message ID that was returned when using <a class="el" href="group__umqtt__api.html#ga2a3023f26a715c8d0435f31616630b77" title="Subscribe to topics. ">umqtt_Subscribe()</a>. The <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> function takes care of tracking acknowledgments and handling retries. </p>

</div>
</div>
<a id="ga7f3ee53207f6b2574af5b99cb00386af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7f3ee53207f6b2574af5b99cb00386af">&#9670;&nbsp;</a></span>UnsubackCb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* UnsubackCb_t) (<a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h, void *pUser, uint16_t pktId)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for Unsuback packets. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle </td></tr>
    <tr><td class="paramname">pUser</td><td>client's optional user data pointer </td></tr>
    <tr><td class="paramname">pktId</td><td>packet ID of the received packet</td></tr>
  </table>
  </dd>
</dl>
<p>This function is called when the umqtt client receives a Unsuback packet in response to <a class="el" href="group__umqtt__api.html#ga918c13b8fe206d6d70cd0dd14764b891" title="Unsubscribe from topics. ">umqtt_Unsubscribe()</a>. It is not necessary for the application to use this callback unless it needs to track completion of unsubscribe messages. The <em>pktId</em> parameter should match the message ID that was returned when using <a class="el" href="group__umqtt__api.html#ga918c13b8fe206d6d70cd0dd14764b891" title="Unsubscribe from topics. ">umqtt_Unsubscribe()</a>. The <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> function takes care of tracking acknowledgments and handling retries. </p>

</div>
</div>
<a id="ga681d6ac338d10f5f6152cbcabb0fcc03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga681d6ac338d10f5f6152cbcabb0fcc03">&#9670;&nbsp;</a></span>PingrespCb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* PingrespCb_t) (<a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h, void *pUser)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for PINGRESP packets. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle </td></tr>
    <tr><td class="paramname">pUser</td><td>client's optional user data pointer</td></tr>
  </table>
  </dd>
</dl>
<p>This function is called when the umqtt client receives a PINGRESP in response to umqtt_Pingreq(). There is no reason for the application to use this callback but it is here for completeness. It could be used as a kind of heartbeat although the interval will not be reliable. The <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> function takes care of sending and receiving ping messages at the appropriate time. </p>

</div>
</div>
<a id="ga3fc8435f85bb4ad53b2fc0210de9b229"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3fc8435f85bb4ad53b2fc0210de9b229">&#9670;&nbsp;</a></span>malloc_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void*(* malloc_t) (size_t size)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Memory allocation function provided by application. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>the number of bytes to be allocated</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the allocated memory or NULL</dd></dl>
<p>This function must be implemented by the application. The umqtt library uses this when it needs to request memory for building MQTT packets. The application is free to implement this in any way. It can just pass through the system malloc, or it could use other memory allocator methods (such as bget). Or it can implement a simple list of fixed buffers and just allocate one of those each time this function is called. </p>

</div>
</div>
<a id="gafa4c1067120f9108fc63bc8c42a68582"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafa4c1067120f9108fc63bc8c42a68582">&#9670;&nbsp;</a></span>free_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* free_t) (void *ptr)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Memory free function provided by application. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr</td><td>pointer to the previously allocated memory buffer</td></tr>
  </table>
  </dd>
</dl>
<p>This function must be implemented by the application. The umqtt library uses this when it needs to free memory that was earlier allocated for packet memory. </p>

</div>
</div>
<a id="gaec5f88823421a42148a27c1d63816679"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaec5f88823421a42148a27c1d63816679">&#9670;&nbsp;</a></span>netReadPacket_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* netReadPacket_t) (void *hNet, uint8_t **ppBuf)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a packet from the network. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hNet</td><td>is the network instance handle (not umqtt instance handle) </td></tr>
    <tr><td class="paramname">ppBuf</td><td>pointer to a pointer to the received packet data</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes that were read from the network. This will be 0 if no data was read, or negative if there is an error.</dd></dl>
<p>This function must be implemented by the application. It is used by the umqtt library when it needs to read a new packet from the network. A double pointer is used (<b>ppBuf</b>) so that the umqtt library does not need to make any additional copy of the data. This function must allocate the memory used to hold the packet in a method compatible with the <a class="el" href="group__umqtt__api.html#ga3fc8435f85bb4ad53b2fc0210de9b229" title="Memory allocation function provided by application. ">malloc_t()</a> / <a class="el" href="group__umqtt__api.html#gafa4c1067120f9108fc63bc8c42a68582" title="Memory free function provided by application. ">free_t()</a> functions. The <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> function will use the <a class="el" href="group__umqtt__api.html#gafa4c1067120f9108fc63bc8c42a68582" title="Memory free function provided by application. ">free_t()</a> function to free this packet after it has been decoded.</p>
<p>The incoming packet must be a complete packet. The <code>umqtt</code> library does not handle partial packets or misaligned packets. </p>

</div>
</div>
<a id="ga5233352739cce7c13897c73aae5b6c5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5233352739cce7c13897c73aae5b6c5f">&#9670;&nbsp;</a></span>netWritePacket_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* netWritePacket_t) (void *hNet, const uint8_t *pBuf, uint32_t len, bool isMore)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a packet to the network. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hNet</td><td>is the network instance handle (not umqtt instance handle) </td></tr>
    <tr><td class="paramname">pBuf</td><td>pointer to the buffer holding the packet data </td></tr>
    <tr><td class="paramname">len</td><td>count of byte in the buffer </td></tr>
    <tr><td class="paramname">isMore</td><td>flag to indicate that there is additional data to send</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes that were written to the network. This will be 0 if no data was written or negative if there was an error.</dd></dl>
<p>This function must be implemented by the application. It is called by the umqtt library when it needs to send a packet to the network. The packet must be all sent or none. The umqtt library cannot handle a partial transmit. If anything less than the complete number of bytes are sent it will be considered a network error. The network write function can optionally use the <em>isMore</em> parameter to aggregate packet data before sending it over the network link. Usually <em>isMore</em> is false. </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="gab0e0dc42aa037235d746ab8c48813ce2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab0e0dc42aa037235d746ab8c48813ce2">&#9670;&nbsp;</a></span>umqtt_Error_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return codes for umqtt functions. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ggab0e0dc42aa037235d746ab8c48813ce2a5f3535a82b5b81d5cb3d80114be26605"></a>UMQTT_ERR_OK&#160;</td><td class="fielddoc"><p>normal return code, no errors </p>
</td></tr>
<tr><td class="fieldname"><a id="ggab0e0dc42aa037235d746ab8c48813ce2a0f4af92039caa0f738e50db89197f67f"></a>UMQTT_ERR_PACKET_ERROR&#160;</td><td class="fielddoc"><p>detected error in packet during decoding </p>
</td></tr>
<tr><td class="fieldname"><a id="ggab0e0dc42aa037235d746ab8c48813ce2a2b46267ea3ed7261d762fa03b4416143"></a>UMQTT_ERR_BUFSIZE&#160;</td><td class="fielddoc"><p>unable to allocate memory for a packet </p>
</td></tr>
<tr><td class="fieldname"><a id="ggab0e0dc42aa037235d746ab8c48813ce2a37139455d211ab8b690c93d0ceb1f77d"></a>UMQTT_ERR_PARM&#160;</td><td class="fielddoc"><p>problem with function input parameter </p>
</td></tr>
<tr><td class="fieldname"><a id="ggab0e0dc42aa037235d746ab8c48813ce2a732e9efdbcc564b1a6ded22bfff4bbb9"></a>UMQTT_ERR_NETWORK&#160;</td><td class="fielddoc"><p>error writing or reading network </p>
</td></tr>
<tr><td class="fieldname"><a id="ggab0e0dc42aa037235d746ab8c48813ce2ab328d3c72d1b256f73c3a79f097ae827"></a>UMQTT_ERR_CONNECT_PENDING&#160;</td><td class="fielddoc"><p>connect is in progress </p>
</td></tr>
<tr><td class="fieldname"><a id="ggab0e0dc42aa037235d746ab8c48813ce2ac67553041aa1fe9580ba9fe32d970998"></a>UMQTT_ERR_CONNECTED&#160;</td><td class="fielddoc"><p>umqtt client is connected to MQTT broker </p>
</td></tr>
<tr><td class="fieldname"><a id="ggab0e0dc42aa037235d746ab8c48813ce2a72bed770239695c9bb69de95863aa483"></a>UMQTT_ERR_DISCONNECTED&#160;</td><td class="fielddoc"><p>umqtt client is not connected to MQTT broker </p>
</td></tr>
<tr><td class="fieldname"><a id="ggab0e0dc42aa037235d746ab8c48813ce2ad50c68dc15caa4c7523d2fad850d5c85"></a>UMQTT_ERR_TIMEOUT&#160;</td><td class="fielddoc"><p>a timeout occurred waiting on some reply </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga58f6b719fbe7a24e6b4a169b315d0eb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga58f6b719fbe7a24e6b4a169b315d0eb1">&#9670;&nbsp;</a></span>umqtt_GetErrorString()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* umqtt_GetErrorString </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a>&#160;</td>
          <td class="paramname"><em>err</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get string representing an error code. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">err</td><td>is the error code to decode</td></tr>
  </table>
  </dd>
</dl>
<p>This function is useful for debugging. It can be used to print a meaningful string for an error code.</p>
<dl class="section return"><dt>Returns</dt><dd>a human readable string representation of the error code </dd></dl>

</div>
</div>
<a id="gae9a94c97eefa8711d10ea5ff41b5849c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae9a94c97eefa8711d10ea5ff41b5849c">&#9670;&nbsp;</a></span>umqtt_Connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> umqtt_Connect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>cleanSession</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>willRetain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>willQos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>keepAlive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>clientId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>willTopic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>willPayload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>willPayloadLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>password</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiate MQTT protocol Connect. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a> </td></tr>
    <tr><td class="paramname">cleanSession</td><td>true to establish new session, false to resume old session </td></tr>
    <tr><td class="paramname">willRetain</td><td>true if published will message should be retained </td></tr>
    <tr><td class="paramname">willQos</td><td>the QoS level to be used for the will message (if used) </td></tr>
    <tr><td class="paramname">keepAlive</td><td>the keep alive interval in seconds </td></tr>
    <tr><td class="paramname">clientId</td><td>the name of the MQTT client to use for the session </td></tr>
    <tr><td class="paramname">willTopic</td><td>optional topic name for will, or NULL </td></tr>
    <tr><td class="paramname">willPayload</td><td>optional will payload, or NULL </td></tr>
    <tr><td class="paramname">willPayloadLen</td><td>length of the will payload message </td></tr>
    <tr><td class="paramname">username</td><td>optional authentication user name, or NULL </td></tr>
    <tr><td class="paramname">password</td><td>optional authentication password, or NULL</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UMQTT_ERR_OK if successful, or an error code if an error occurred</dd></dl>
<p>This function will create a MQTT Connect packet and attempt to send it to the MQTT broker. The network connection to the MQTT server port should already be established. When the function returns, the Connect packet has been sent or there was an error. Upon return, the MQTT connection is pending, it is not yet established. The connection is not established until the MQTT broker sends a Connack packet, which can be detected by either using the Connack callback function, or when <a class="el" href="group__umqtt__api.html#ga3cb230dbd2737e18b7b1ec454497df3c" title="Get the status of the connection. ">umqtt_GetConnectedStatus()</a> returns UMQTT_ERR_CONNECTED.</p>
<p>Possible return codes:</p>
<table class="doxtable">
<tr>
<th>Code </th><th>Reason  </th></tr>
<tr>
<td>UMQTT_ERR_OK </td><td>Connect packet was transmitted </td></tr>
<tr>
<td>UMQTT_ERR_PARM </td><td>detected an error in a function parameter </td></tr>
<tr>
<td>UMQTT_ERR_BUFSIZE </td><td>memory allocation failed </td></tr>
<tr>
<td>UMQTT_ERR_NETWORK </td><td>error writing packet to network </td></tr>
<tr>
<td>UMQTT_ERR_CONNECTED </td><td>MQTT connection is already established </td></tr>
<tr>
<td>UMQTT_ERR_CONNECT_PENDING </td><td>MQTT connection is already in progress </td></tr>
</table>
<p><b>Example</b></p>
<div class="fragment"><div class="line"><a class="code" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h; <span class="comment">// previously acquired instance handle</span></div><div class="line"><span class="keywordtype">char</span> clientName[] = <span class="stringliteral">&quot;myMqttClient&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> willTopic[] = <span class="stringliteral">&quot;myWillTopic&quot;</span>;</div><div class="line">uint8_t willPayload[] = (uint8_t *)<span class="stringliteral">&quot;myWillMessage&quot;</span>;</div><div class="line"></div><div class="line"><a class="code" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> err;</div><div class="line">err = <a class="code" href="group__umqtt__api.html#gae9a94c97eefa8711d10ea5ff41b5849c">umqtt_Connect</a>(h, <span class="keyword">true</span>, <span class="keyword">false</span>, 0, 30, <span class="comment">// clean session, 30 secs keep alive</span></div><div class="line">                    clientName, willTopic,</div><div class="line">                    willPayload, strlen(willPayload),</div><div class="line">                    NULL, NULL); <span class="comment">// no username or password</span></div><div class="line"><span class="keywordflow">if</span> (err != <a class="code" href="group__umqtt__api.html#ggab0e0dc42aa037235d746ab8c48813ce2a5f3535a82b5b81d5cb3d80114be26605">UMQTT_ERR_OK</a>)</div><div class="line">{</div><div class="line">    <span class="comment">// handle error</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span></div><div class="line">{</div><div class="line">    <span class="comment">// connect is in progress</span></div><div class="line">}</div></div><!-- fragment --> 
</div>
</div>
<a id="ga3a3c80101e4e166fe2af31a4a74ad67a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3a3c80101e4e166fe2af31a4a74ad67a">&#9670;&nbsp;</a></span>umqtt_Disconnect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> umqtt_Disconnect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disconnect MQTT protocol. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UMQTT_ERR_OK or an error code</dd></dl>
<p>This function attempts to send a MQTT protocol disconnect packet, frees up all pending packets and marks the instance as disconnected. </p>

</div>
</div>
<a id="ga42af6bf8d61c0c3e3c56397fde99c73c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga42af6bf8d61c0c3e3c56397fde99c73c">&#9670;&nbsp;</a></span>umqtt_Publish()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> umqtt_Publish </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>payloadLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>qos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shouldRetain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>pId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send MQTT protocol Publish packet. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a> </td></tr>
    <tr><td class="paramname">topic</td><td>topic name to publish </td></tr>
    <tr><td class="paramname">payload</td><td>payload or message for the topic (can be NULL) </td></tr>
    <tr><td class="paramname">payloadLen</td><td>number of bytes in the payload </td></tr>
    <tr><td class="paramname">qos</td><td>QoS (quality of service) level for this topic </td></tr>
    <tr><td class="paramname">shouldRetain</td><td>true if MQTT broker should retain this topic </td></tr>
    <tr><td class="paramname">pId</td><td>pointer to storage for assigned packet ID (optional)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UMQTT_ERR_OK if successful, or an error code if an error occurred</dd></dl>
<p>This function is used to publish a topic with an optional payload. A publish packet will be assembled and sent to the connected UMQTT broker. If the QoS &gt; 0 then the packet will be held and resent as needed until an acknowledgment is received. If this happens, then the Publish packet will have a packet ID. The <em>pId</em> parameter can be used to get the packet ID if needed. Otherwise, this parameter can be set to NULL. If the QoS is 0, then there is no packet ID.</p>
<p>If a callback function was provided for Puback, then the Puback callback will be called when the publish packet is acknowledged.</p>
<p>A payload is not required. MQTT can publish only a topic name with no payload. If a payload is not used then the parameter can be set to NULL. The payload can be binary data and not necessarily a string.</p>
<dl class="section note"><dt>Note</dt><dd>At this time, the umqtt library does not support QoS level 2</dd></dl>
<p><b>Example</b></p>
<div class="fragment"><div class="line"><a class="code" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h; <span class="comment">// previously acquired instance handle</span></div><div class="line"><span class="keywordtype">char</span> topicName[] = <span class="stringliteral">&quot;myTopic&quot;</span>;</div><div class="line">uint8_t payload[] = (uint8_t *)<span class="stringliteral">&quot;myPayloadMessage&quot;</span>;</div><div class="line">uint16_t msgId;</div><div class="line"></div><div class="line"><a class="code" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> err;</div><div class="line">err = <a class="code" href="group__umqtt__api.html#ga42af6bf8d61c0c3e3c56397fde99c73c">umqtt_Publish</a>(h, topicName, payload, strlen(payload),</div><div class="line">                    1, <span class="keyword">true</span>, *msgId);</div><div class="line"><span class="keywordflow">if</span> (err == <a class="code" href="group__umqtt__api.html#ggab0e0dc42aa037235d746ab8c48813ce2a5f3535a82b5b81d5cb3d80114be26605">UMQTT_ERR_OK</a>)</div><div class="line">{</div><div class="line">    <span class="comment">// Publish packet has been sent with QoS 1</span></div><div class="line">    <span class="comment">// Packet is pending acknowledgment</span></div><div class="line">    <span class="comment">// msgId now contains the packet ID that was used</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> <span class="comment">// error occurred</span></div><div class="line">{</div><div class="line">    <span class="comment">// handle publish error</span></div><div class="line">}</div></div><!-- fragment --> 
</div>
</div>
<a id="ga2a3023f26a715c8d0435f31616630b77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2a3023f26a715c8d0435f31616630b77">&#9670;&nbsp;</a></span>umqtt_Subscribe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> umqtt_Subscribe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>topics</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>qoss</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>pId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subscribe to topics. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a> </td></tr>
    <tr><td class="paramname">count</td><td>number of topics in the list of topics to subscribe </td></tr>
    <tr><td class="paramname">topics</td><td>array of topic names to subscribe </td></tr>
    <tr><td class="paramname">qoss</td><td>array of QoS values to use for subscribed topics </td></tr>
    <tr><td class="paramname">pId</td><td>pointer to storage for assigned packet ID (optional)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UMQTT_ERR_OK if successful, or an error code if an error occurred</dd></dl>
<p>This function is used to send a subscribe request to an MQTT broker. It can be used to subscribe to one or more topics at one time. Each subscribed topic can be assigned a QoS level.</p>
<p>A subscribe packet will be held pending until it is acknowledged by the MQTT broker. If the caller provided the <em>pId</em> parameter, then the packet ID will be saved for the caller. If the caller does not need the packet ID, then <em>pId</em> parameter can be NULL.</p>
<p>If the caller provided a Suback callback function, then it will be notified when the subscribe request is acknowledged.</p>
<p><b>Example</b></p>
<div class="fragment"><div class="line"><a class="code" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h; <span class="comment">// previously acquired instance handle</span></div><div class="line"><span class="keywordtype">char</span> *topics[] = { <span class="stringliteral">&quot;topic1&quot;</span>, <span class="stringliteral">&quot;topic2&quot;</span> };</div><div class="line">uint8_t qoss[] = { 0, 1 };</div><div class="line">uint16_t msgId;</div><div class="line"></div><div class="line"><a class="code" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> err;</div><div class="line">err = <a class="code" href="group__umqtt__api.html#ga2a3023f26a715c8d0435f31616630b77">umqtt_Subscribe</a>(h, 2, topics, qoss, &amp;msgId);</div><div class="line"><span class="keywordflow">if</span> (err == <a class="code" href="group__umqtt__api.html#ggab0e0dc42aa037235d746ab8c48813ce2a5f3535a82b5b81d5cb3d80114be26605">UMQTT_ERR_OK</a>)</div><div class="line">{</div><div class="line">    <span class="comment">// Subscribe packet has been sent with requested topics</span></div><div class="line">    <span class="comment">// Packet is pending acknowledgment</span></div><div class="line">    <span class="comment">// msgId now contains the packet ID that was used</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> <span class="comment">// error occurred</span></div><div class="line">{</div><div class="line">    <span class="comment">// handle subscribe error</span></div><div class="line">}</div></div><!-- fragment --> 
</div>
</div>
<a id="ga918c13b8fe206d6d70cd0dd14764b891"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga918c13b8fe206d6d70cd0dd14764b891">&#9670;&nbsp;</a></span>umqtt_Unsubscribe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> umqtt_Unsubscribe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topics</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>pId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubscribe from topics. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a> </td></tr>
    <tr><td class="paramname">count</td><td>count of topics in topic list </td></tr>
    <tr><td class="paramname">topics</td><td>array of topic names to unsubscribe </td></tr>
    <tr><td class="paramname">pId</td><td>pointer to storage for assigned packet ID (optional)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UMQTT_ERR_OK if successful, or an error code if an error occurred</dd></dl>
<p>This function is used to send an unsubscribe request to an MQTT broker. It can be used to unsubscribe from one or more topics at one time.</p>
<p>An unsubscribe packet will be held pending until it is acknowledged by the MQTT broker. If the caller provided the <em>pId</em> parameter, then the packet ID will be saved for the caller. If the caller does not need the packet ID, then <em>pId</em> parameter can be NULL.</p>
<p>If the caller provided a Unsuback callback function, then it will be notified when the unsubscribe request is acknowledged.</p>
<p><b>Example</b></p>
<div class="fragment"><div class="line"><a class="code" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h; <span class="comment">// previously acquired instance handle</span></div><div class="line"><span class="keywordtype">char</span> *topics[] = { <span class="stringliteral">&quot;topic1&quot;</span>, <span class="stringliteral">&quot;topic2&quot;</span> };</div><div class="line">uint16_t msgId;</div><div class="line"></div><div class="line"><a class="code" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> err;</div><div class="line">err = <a class="code" href="group__umqtt__api.html#ga918c13b8fe206d6d70cd0dd14764b891">umqtt_Unsubscribe</a>(h, 2, topics, &amp;msgId);</div><div class="line"><span class="keywordflow">if</span> (err == <a class="code" href="group__umqtt__api.html#ggab0e0dc42aa037235d746ab8c48813ce2a5f3535a82b5b81d5cb3d80114be26605">UMQTT_ERR_OK</a>)</div><div class="line">{</div><div class="line">    <span class="comment">// Unsubscribe packet has been sent with topic list</span></div><div class="line">    <span class="comment">// Packet is pending acknowledgment</span></div><div class="line">    <span class="comment">// msgId now contains the packet ID that was used</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> <span class="comment">// error occurred</span></div><div class="line">{</div><div class="line">    <span class="comment">// handle unsubscribe error</span></div><div class="line">}</div></div><!-- fragment --> 
</div>
</div>
<a id="ga1bc35b68c4f3bcc8e693b2ef3eb4df40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1bc35b68c4f3bcc8e693b2ef3eb4df40">&#9670;&nbsp;</a></span>umqtt_PingReq()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> umqtt_PingReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a Ping (keep-alive) to the MQTT broker. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UMQTT_ERR_OK if successful, or an error code if an error occurred</dd></dl>
<p>This function is used to send a Ping Request to the MQTT broker. The client is required to periodically send Ping messages to keep the connection alive. This function is provided as a convenience but should not normally ever need to be called by the client application. The keep-alive/ping process is handled by the <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> function. </p>

</div>
</div>
<a id="ga9e25d2f2e7334489d543042d78a8720d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9e25d2f2e7334489d543042d78a8720d">&#9670;&nbsp;</a></span>umqtt_DecodePacket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> umqtt_DecodePacket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>pIncoming</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>incomingLen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode incoming MQTT packet. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a> </td></tr>
    <tr><td class="paramname">pIncoming</td><td>buffer holding incoming UMQTT packet </td></tr>
    <tr><td class="paramname">incomingLen</td><td>number of bytes in the incoming buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UMQTT_ERR_OK if successful, or an error code if an error occurred</dd></dl>
<p>This function is used to decode incoming MQTT packets from the server. It is normally called from <a class="el" href="group__umqtt__api.html#gac66e219c2735186b5c2afb7ff753de6a" title="Main loop processing for the umqtt client instance. ">umqtt_Run()</a> and the client application does not need to call this directly. However, it is provided for completeness.</p>
<p>The caller passes a buffer containing an MQTT protocol packet that was received from the network. The packet will be decoded and if valid the appropriate action taken. The action depends on the packet:</p>
<table class="doxtable">
<tr>
<th>Type </th><th>Action  </th></tr>
<tr>
<td>CONNACK </td><td>Free pending connect, notify client if callback is provided </td></tr>
<tr>
<td>PUBLISH </td><td>Extract publish topic, notify client through callback </td></tr>
<tr>
<td>PUBACK </td><td>Free pending Publish, notify client if callback is provided </td></tr>
<tr>
<td>SUBACK </td><td>Free pending Subscribe, notify client if callback is provided </td></tr>
<tr>
<td>UNSUBACK </td><td>Free pending Unsubscribe, notify client if callback is provided </td></tr>
<tr>
<td>PINGRESP </td><td>No action except notify client if a callback is provided </td></tr>
</table>

</div>
</div>
<a id="ga3cb230dbd2737e18b7b1ec454497df3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3cb230dbd2737e18b7b1ec454497df3c">&#9670;&nbsp;</a></span>umqtt_GetConnectedStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> umqtt_GetConnectedStatus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the status of the connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a></td></tr>
  </table>
  </dd>
</dl>
<p>Use this function to determine the state of connectedness of the UMQTT client. It will return one of the following:</p>
<ul>
<li>UMQTT_ERR_CONNECTED</li>
<li>UMQTT_ERR_CONNECT_PENDING</li>
<li>UMQTT_ERR_DISCONNECTED</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>return code indicating the connection state </dd></dl>

</div>
</div>
<a id="gae616c0381b1752a036e9322a7fcc6922"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae616c0381b1752a036e9322a7fcc6922">&#9670;&nbsp;</a></span>umqtt_New()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> umqtt_New </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structumqtt___transport_config__t.html">umqtt_TransportConfig_t</a> *&#160;</td>
          <td class="paramname"><em>pTransport</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structumqtt___callbacks__t.html">umqtt_Callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>pCallbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pUser</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create and initialize a umqtt client instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pTransport</td><td>structure defining the MQTT transport interface </td></tr>
    <tr><td class="paramname">pCallbacks</td><td>structure holding the callback functions </td></tr>
    <tr><td class="paramname">pUser</td><td>optional caller defined data pointer that will be passed in callbacks</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><em>umqtt</em> instance handle that should be used for all other function calls, or NULL if there is an error.</dd></dl>
<p>This function will allocate a <em>umqtt</em> instance and initialize it. No actual MQTT operations are performed. The caller must provide the network access functions through the pTransport parameter. Callback functions are used for notification and are optional. If used, callback functions are provided by the pCallbacks parameter. The entire parameter can be NULL if no callbacks are used, or individual callbacks can be NULL within the structure.</p>
<p><b>Example</b> </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> PublishCb(<a class="code" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h, <span class="keywordtype">void</span> *pUser, <span class="keywordtype">bool</span> dup, <span class="keywordtype">bool</span> retain,</div><div class="line">               <span class="keyword">const</span> <span class="keywordtype">char</span> *topic, uint16_t topicLen,</div><div class="line">               <span class="keyword">const</span> uint8_t *msg, uint16_t msgLen)</div><div class="line">{</div><div class="line">    <span class="comment">// publish handler</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="structumqtt___transport_config__t.html">umqtt_TransportConfig_t</a> transport =</div><div class="line">{</div><div class="line">    myNetworkHandle, <span class="comment">// optional, if network has a handle or instance</span></div><div class="line">    malloc, free,</div><div class="line">    myNetReadFunction, myNetWriteFunction</div><div class="line">};</div><div class="line"><a class="code" href="structumqtt___callbacks__t.html">umqtt_Callbacks_t</a> callbacks = <span class="comment">// only publish callback is defined</span></div><div class="line">    { NULL, PublishCb, NULL, NULL, NULL, NULL };</div><div class="line"></div><div class="line"><a class="code" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a> h;</div><div class="line">h = <a class="code" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922">umqtt_New</a>(&amp;transport, &amp;callbacks, NULL);</div><div class="line"><span class="keywordflow">if</span> (h == NULL)</div><div class="line">{</div><div class="line">    <span class="comment">// handle error</span></div><div class="line">}</div></div><!-- fragment --> 
</div>
</div>
<a id="ga11ca938958786580b20364192e20156c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga11ca938958786580b20364192e20156c">&#9670;&nbsp;</a></span>umqtt_Delete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void umqtt_Delete </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clean up and free umqtt client instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a></td></tr>
  </table>
  </dd>
</dl>
<p>This function is used to free all allocated memory by the umqtt instance. It should be called as part of an orderly shutdown. </p>

</div>
</div>
<a id="gac66e219c2735186b5c2afb7ff753de6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac66e219c2735186b5c2afb7ff753de6a">&#9670;&nbsp;</a></span>umqtt_Run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__umqtt__api.html#gab0e0dc42aa037235d746ab8c48813ce2">umqtt_Error_t</a> umqtt_Run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__umqtt__api.html#ga48b3931c173f616ae6b9e5aa8fe24a20">umqtt_Handle_t</a>&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>msTicks</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main loop processing for the umqtt client instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h</td><td>umqtt instance handle from <a class="el" href="group__umqtt__api.html#gae616c0381b1752a036e9322a7fcc6922" title="Create and initialize a umqtt client instance. ">umqtt_New()</a> </td></tr>
    <tr><td class="paramname">msTicks</td><td>milliseconds tick count</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>UMQTT_ERR_OK if everything is normal, or an error code if something goes wrong</dd></dl>
<p>This function should be called repeatedly from the application main loop. The application must maintain an incrementing millisecond tick counter and pass that to the Run function. This tick value is used to keep track of internal timeouts. The Run function performs the following actions:</p>
<ul>
<li>check for any incoming packets, decode and process</li>
<li>check for ping timeout and send ping packet if needed</li>
<li>check for timed out pending packets and resend or expire</li>
</ul>
<p>The Run function can encounter several kinds of errors while peforming its process. If nothing goes wrong it will return UMQTT_ERR_OK. If something goes wrong, it will return the most recent error code, even if multiple errors are encountered. For this reason, the caller cannot conclusively know the cause of a problem based on error code. Instead, the presence of a non-OK return value means that something has gone wrong and the caller should probably initiate a recovery procedure. Even when errors are encountered, the Run function attempts to carry out all required actions and does not automatically disconnect or change internal state. The following error codes can be returned:</p>
<table class="doxtable">
<tr>
<th>Code </th><th>Reason  </th></tr>
<tr>
<td>UMQTT_ERR_OK </td><td>Run() did not encounter any problem </td></tr>
<tr>
<td>UMQTT_ERR_PARM </td><td>detected an error in a function parameter </td></tr>
<tr>
<td>UMQTT_ERR_BUFSIZE </td><td>memory allocation failed </td></tr>
<tr>
<td>UMQTT_ERR_NETWORK </td><td>error reading or writing the network </td></tr>
<tr>
<td>UMQTT_ERR_TIMEOUT </td><td>a pending packet has timed out </td></tr>
</table>
<p>In the case of UMQTT_ERR_TIMEOUT, it means either that no CONNACK was received in response to a Connect attempt, or that one of the other pending packet types has completely expired all of its retry attempts. In any case this probably indicates something has gone wrong with the connection to the MQTT broker. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Sep 22 2017 23:09:08 for uMQTT by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
